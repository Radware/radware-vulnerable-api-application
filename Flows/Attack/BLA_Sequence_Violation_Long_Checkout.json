{
  "id": "flow_bla_sequence_violation_long_checkout",
  "name": "BLA: Sequence Violation (Long Checkout Detour)",
  "description": "GraceWilson applies a coupon and checks legacy status before any order exists, then creates an order without the usual browse/list steps and checks order details before listing orders.",
  "headers": {
    "Accept": "application/json"
  },
  "staticVars": {
    "baseUrl": "https://bla-bypass.ase-team.com",
    "graceUsername": "GraceWilson",
    "gracePassword": "GracePass7&",
    "graceUserId": "00000008-0000-0000-0000-000000000008",
    "graceAddressId": "ad000008-0001-0000-0000-000000000001",
    "graceCardId": "cc000008-0001-0000-0000-000000000001",
    "targetProductId": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
    "fakeOrderId": "ffffffff-ffff-ffff-ffff-ffffffffffff",
    "invalidCouponCode": "NOTACOUPON999",
    "legacyToken": "legacy-detour"
  },
  "steps": [
    {
      "id": "step_grace_login_sequence_long",
      "name": "Login GraceWilson",
      "type": "request",
      "method": "POST",
      "url": "{{baseUrl}}/api/auth/login?username={{graceUsername}}&password={{gracePassword}}",
      "onFailure": "stop",
      "extract": {
        "grace_token": "body.access_token"
      }
    },
    {
      "id": "step_grace_apply_coupon_before_order",
      "name": "Apply Coupon Before Order (Out of Sequence)",
      "type": "request",
      "method": "POST",
      "url": "{{baseUrl}}/api/users/{{graceUserId}}/orders/{{fakeOrderId}}/apply-coupon?coupon_code={{invalidCouponCode}}",
      "headers": {
        "Authorization": "Bearer {{grace_token}}"
      },
      "onFailure": "continue"
    },
    {
      "id": "step_grace_status_legacy_before_order",
      "name": "Legacy Order Status Before Order Exists",
      "type": "request",
      "method": "GET",
      "url": "{{baseUrl}}/api/users/{{graceUserId}}/orders/{{fakeOrderId}}/status-legacy?legacy_token={{legacyToken}}",
      "headers": {
        "Authorization": "Bearer {{grace_token}}"
      },
      "onFailure": "continue"
    },
    {
      "id": "step_grace_create_order_direct",
      "name": "Create Order Directly (Skip Browse/List Steps)",
      "type": "request",
      "method": "POST",
      "url": "{{baseUrl}}/api/users/{{graceUserId}}/orders?address_id={{graceAddressId}}&credit_card_id={{graceCardId}}&product_id_1={{targetProductId}}&quantity_1=1",
      "headers": {
        "Authorization": "Bearer {{grace_token}}"
      },
      "extract": {
        "order_id": "body.order_id"
      },
      "onFailure": "stop"
    },
    {
      "id": "step_grace_order_detail_before_list",
      "name": "Order Detail Before Listing Orders",
      "type": "request",
      "method": "GET",
      "url": "{{baseUrl}}/api/users/{{graceUserId}}/orders/{{order_id}}",
      "headers": {
        "Authorization": "Bearer {{grace_token}}"
      },
      "onFailure": "continue"
    },
    {
      "id": "step_grace_status_legacy_before_list",
      "name": "Legacy Order Status Before Listing Orders",
      "type": "request",
      "method": "GET",
      "url": "{{baseUrl}}/api/users/{{graceUserId}}/orders/{{order_id}}/status-legacy?legacy_token={{legacyToken}}",
      "headers": {
        "Authorization": "Bearer {{grace_token}}"
      },
      "onFailure": "continue"
    },
    {
      "id": "step_grace_list_orders_after",
      "name": "List Orders After Detour",
      "type": "request",
      "method": "GET",
      "url": "{{baseUrl}}/api/users/{{graceUserId}}/orders",
      "headers": {
        "Authorization": "Bearer {{grace_token}}"
      },
      "onFailure": "continue"
    }
  ],
  "visualLayout": {
    "step_grace_login_sequence_long": { "x": 50, "y": 50 },
    "step_grace_apply_coupon_before_order": { "x": 250, "y": 50 },
    "step_grace_status_legacy_before_order": { "x": 450, "y": 50 },
    "step_grace_create_order_direct": { "x": 650, "y": 50 },
    "step_grace_order_detail_before_list": { "x": 250, "y": 150 },
    "step_grace_status_legacy_before_list": { "x": 450, "y": 150 },
    "step_grace_list_orders_after": { "x": 650, "y": 150 }
  }
}
